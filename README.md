# üöÄ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Ç—Ä—É–±–∞—Ö

–ê–ª–≥–æ—Ä–∏—Ç–º, –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∫—É –Ω–∞ —Ç—Ä—É–±–µ, —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–µ–π –∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–¥ –º–∞—Å–∫—É

---

# üìå –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
* [–û–ø–∏—Å–∞–Ω–∏–µ](#info)
* [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#use)
* [–ü—Ä–∏–º–µ—Ä](#example)
* [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#install)
* [–ù–∞—Å—Ç—Ä–æ–π–∫–∏](#settings)
* [–û—à–∏–±–∫–∏](#error)

---

<a id="info"></a>
# üìù –û–ø–∏—Å–∞–Ω–∏–µ
–ê–ª–≥–æ—Ä–∏—Ç–º, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞—ç–µ–Ω–∏–µ –≤ 5 —ç—Ç–∞–ø–æ–≤:
* –ü–æ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞, —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É
* –ü–æ–∏—Å–∫ —Ä–∞–º–∫–∏ —Å –ø–æ–º–æ—â—å—é YOLO
* –†–∞—Å–ø–æ–∑–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é 0: base_ru 1: easy_ocr
* –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
* –ü–æ–∏—Å–∫ —Å—Ö–æ–∂–∏—Ö –º–∞—Ä–∫–∏—Ä–æ–≤–æ–∫ –≤ —Å–ø–∏—Å–∫–µ –∏ –≤—ã–≤–æ–¥ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –∫–∞–∫–æ–π –æ–Ω–∞ –º–æ–∂–µ—Ç —è–≤–ª—è—Ç—Å—è

---

<a id="use"></a>
# üõ† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∏—Ç:
1. status - –û–±–æ–∑–Ω–∞—á–∞–µ—Ç –≤–æ–∑–Ω–∏–∫–ª–∏ –ª–∏ –∫–∞–∫–∏–µ-–Ω–∏–±—É–¥—å –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å–ø–æ–∑–Ω–æ–≤–∞–Ω–∏—è
2. mess - –í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∏
3. text - –¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ OCR
4. marker - –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. timer - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
6. previously - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–µ–∑–∫–∏
7. markers - –°–ø–∏—Å–æ–∫ –º–∞—Ä–∫–∏—Ä–æ–≤–æ–∫ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã–π –ø–æ —Å—Ö–æ–∂–µ—Å—Ç—å—é —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
8. logs - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç ```dict()```, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–µ, –∏–ª–∏ –≤—ã–≤–æ–¥–∏—Ç —Ç–æ –¥–ª—è —á–µ–≥–æ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∑–∞–º–µ–Ω–∞ –∏–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ Adding: –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ, Correction: –í–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä ```{'error_code': '003', 'error': ['Adding –¢–ú–ö', 'Correction factory: –¢–ü–ó->–ß–¢–ü–ó', 'Correction steel: –ó–û–ì2->30–ì2']}```
9. adjustments - –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º —á—Ç–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ç–æ—á–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –Ω–æ–∏–µ—Ä –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏, –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ–º—É —Å–ø–∏—Å–∫—É –≤—ã–±—Ä–∞—Ç—å ```{"error_code": "004", "error": "Unable to accurately determine the room number"}```

---

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥:
* path - –ü—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ *.json —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

```
record = Record() # –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ files/settings.json
record = Record(r"mysettings.json") # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

---

–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:
* input - –í—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
* numModel - –ù–æ–º–µ—Ä –º–æ–¥–µ–ª–∏ 0: base_ru 1: easy_ocr
* pipe_numbers - –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Ç—Ä—É–± (–æ–ø—Ü–∏–æ–Ω–Ω–æ)
* structure - –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ —á—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–µ, –ø—Ä–∏–º–µ—Ä {"company": "–¢–ú–ö", "factory": "–ß–¢–ü–ó", "steel": "30–ì2"}

```
status, mess, text, marker, timer, previously, markers, logs, adjustments = record(img, 1)
status, mess, text, marker, timer, previously, markers, logs, adjustments = record(img, 0, ['01693', '01699', '02691', '51691', '52691'])
status, mess, text, marker, timer, previously, markers, logs, adjustments = record(img, 1, ['01693', '01699', '02691', '51691', '52691'], {"company": "–¢–ú–ö", "factory": "–ß–¢–ü–ó", "steel": "30–ì2", "number": 5})
```

---

<a id="example"></a>
# ‚ú® –ü—Ä–∏–º–µ—Ä

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ main.py, –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ –≤ camera.py

``` main.py
from Recognition import Record
import cv2

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–µ–∫–æ–¥–µ—Ä
record = Record()

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
img = cv2.imread("img.jpg")

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞—Ä–∫–∏—Ä–æ–≤–∫—É
status, mess, text, marker, timer, previously, markers, logs, adjustments = record(img, 1, ['01693', '01699', '02691', '51691', '52691'])

# –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
cv2.imwrite("1.jpg", previously)

# –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if status:
    print('--------------------------')

    # –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã
    print(text, " to ", marker)
    print('--------------------------')

    # –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    print(timer, " sec.")
    print('--------------------------')

    # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    if logs != {} or adjustments != None:
        if logs != {}: print("Notes: ", logs)
        if adjustments != None: print(adjustments)
        print('--------------------------')

    # –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    if len(markers) > 1:
        print("List of options")
        for i in markers: print(i)
        print('--------------------------')

    # –ò—Ç–æ–≥–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    cv2.imwrite("2.jpg", mess)
else:
    print(mess)
```

---

<a id="install"></a>
# üì≤ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
git clone https://github.com/ByVladislav/MarkingRecognition.git
cd MarkingRecognition
pip install -r requirements.txt
```

---

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å trocr-base-ru, –ø–æ –ø—É—Ç—é MarkingRecognition/files/trocr-base-ru

–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://huggingface.co/raxtemur/trocr-base-ru/tree/main

---

–í —Ñ–∞–π–ª–µ **MarkingRecognition\\.venv\Lib\site-packages\easyocr\utils.py** –≤ —Å—Ç—Ä–æ—á–∫–µ 582 –∏—Å–ø—Ä–∞–≤–∏—Ç—å ```maximum_y,maximum_x = img.shape``` –Ω–∞ ```maximum_y,maximum_x, _ = img.shape```

---

<a id="settings"></a>
# ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–í –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤—Ö–æ–¥–∏—Ç 7 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
1. top_percent - –ü—Ä–æ—Ü–µ–Ω—Ç –æ–±—Ä–µ–∑–∫–∏ —Å–≤–µ—Ä—Ö–∫
2. bottom_percent - –ü—Ä–æ—Ü–µ–Ω—Ç –æ–±—Ä–µ–∑–∫–∏ —Å–Ω–∏–∑—É
3. height - –í—ã—Å–æ—Ç–∞ –∫–∞–¥—Ä–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (—É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä—ã–≤—ã –º–µ–∂–¥—É –ª–∏–Ω–∏—è–º–∏ –±—É–∫–≤)
4. Significance - –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–æ–∫ –ø–æ—Ö–æ–∂–∏—Ö –º–∞—Ä–∫–∏—Ä–æ–≤–æ–∫
5. BestScore - –ü–æ—Ä–æ–≥ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ (–∫–æ–Ω–µ—á–Ω–æ–≥–æ) —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. path_YOLO - –ü—É—Ç—å –¥–æ YOLO –º–æ–¥–µ–ª–∏
7. path_TROCR - –ü—É—Ç—å –¥–æ –º–æ–¥–µ–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ TrOCR

---

–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```
{
  "top_percent": 0.45,
  "bottom_percent": 0.35,
  "height": 75,
  "Significance": 0.5,
  "BestScore": 0.6,
  "path_YOLO": "files/model v1.pt",
  "path_TROCR": "files/trocr-base-ru"
}
```

---

<a id="error"></a>
# üìé –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

* ```{"error_code":"001", "error":"Not detecting marking"}``` - –û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–≥–æ —á—Ç–æ –º–æ–¥–µ–ª—å YOLO –Ω–µ –Ω–∞—à–ª–∞ —Ä–∞–º–∫—É
* ```{"error_code":"002", "error":"Unable to find pipe number"}``` - –û–±–æ–∑–Ω–∞—á–∞–µ—Ç —Ç–æ —á—Ç–æ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –Ω–æ–º–µ—Ä —Ç—Ä—É–±—ã
* ```{'error_code': '003', 'error': ['Adding –¢–ú–ö', 'Correction factory: –¢–ü–ó->–ß–¢–ü–ó]}``` - –û–±–æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞
* ```{"error_code": "004", "error": "Unable to accurately determine the room number"}``` - –û–±–æ–∑–Ω–∞—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º —á—Ç–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ç–æ—á–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –Ω–æ–∏–µ—Ä –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏, –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ–º—É —Å–ø–∏—Å–∫—É –≤—ã–±—Ä–∞—Ç—å

---
